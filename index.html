<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StarClad Privacy Swap - Production Ready</title>
    <script src="https://cdn.jsdelivr.net/npm/starknet@5.24.3/dist/starknet.min.js"></script>
    <script src="https://unpkg.com/get-starknet@3.0.3"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .app {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { color: #667eea; margin-bottom: 10px; }
        .status { 
            padding: 15px;
            background: #f0f0f0;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .section {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }
        h2 { color: #667eea; margin-bottom: 15px; font-size: 1.3rem; }
        input, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px 5px 5px 0;
        }
        button:hover { opacity: 0.9; }
        .console {
            background: #1e1e1e;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .console-entry { margin: 3px 0; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #0af; }
        .output {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 250px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .data-item {
            background: #e8f4fd;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .connected { background: #d4edda; border-color: #28a745; }
        .disconnected { background: #f8d7da; border-color: #dc3545; }
    </style>
</head>
<body>
    <div class="app">
        <h1>üîê StarClad Privacy Swap - Production</h1>
        <p style="margin-bottom: 20px; color: #666;">Complete working frontend for all 16 backend modules</p>

        <!-- CONFIGURATION -->
        <div class="section">
            <h2>‚öôÔ∏è Configuration</h2>
            <label><strong>Backend URL:</strong></label>
            <input type="text" id="backendUrl" value="https://localhost:3443" placeholder="Backend API URL">
            
            <label><strong>API Key (Optional):</strong></label>
            <input type="password" id="apiKey" placeholder="API Key">
            
            <label><strong>Swap Contract Address:</strong></label>
            <input type="text" id="swapContract" placeholder="0x..." value="">
            
            <label><strong>Bridge Contract Address:</strong></label>
            <input type="text" id="bridgeContract" placeholder="0x..." value="">
            
            <button onclick="app.saveConfig()">üíæ Save Configuration</button>
            <button onclick="app.testBackend()">üîå Test Backend Connection</button>
            <button onclick="app.connectWallet()">üëõ Connect Starknet Wallet</button>
            
            <div id="status" class="status disconnected">
                <strong>Backend:</strong> <span id="backendStatus">Not connected</span><br>
                <strong>Wallet:</strong> <span id="walletStatus">Not connected</span>
            </div>
        </div>

        <!-- CONSOLE LOGS -->
        <div class="section">
            <h2>üìü Console Logs (Real-time)</h2>
            <div id="console" class="console">
                <div class="console-entry info">[INFO] Application started</div>
                <div class="console-entry info">[INFO] Waiting for configuration...</div>
            </div>
            <button onclick="app.clearConsole()">Clear Console</button>
        </div>

        <!-- PRIVACY NOTES -->
        <div class="section">
            <h2>üìù Privacy Notes</h2>
            
            <h3>Generate New Note:</h3>
            <label>Amount (satoshis):</label>
            <input type="number" id="noteAmount" placeholder="1000000" value="1000000">
            
            <label>Recipient Address:</label>
            <input type="text" id="noteRecipient" placeholder="0x... (leave empty to use your wallet)">
            
            <label>Secret (Optional):</label>
            <input type="text" id="noteSecret" placeholder="Leave empty for auto-generation">
            
            <button onclick="app.generateNote()">‚ú® Generate Privacy Note</button>
            <div id="noteOutput" class="output" style="display:none;"></div>
            
            <h3>Generate Spend Proof:</h3>
            <label>Commitment Hash:</label>
            <input type="text" id="proofCommitment" placeholder="0x...">
            
            <label>Spender Address:</label>
            <input type="text" id="proofSpender" placeholder="0x...">
            
            <button onclick="app.generateSpendProof()">üîê Generate Spend Proof</button>
            <div id="proofOutput" class="output" style="display:none;"></div>
            
            <h3>Merkle Tree:</h3>
            <button onclick="app.getMerkleRoot()">üå≥ Get Merkle Root</button>
            <div id="merkleOutput" class="output" style="display:none;"></div>
            
            <h3>Your Notes:</h3>
            <div id="notesList"></div>
        </div>

        <!-- ATOMIC SWAPS -->
        <div class="section">
            <h2>üîÑ Atomic Swaps</h2>
            
            <h3>1. Initiate Swap:</h3>
            <label>Initiator Address:</label>
            <input type="text" id="swapInitiator" placeholder="0x... (your address)">
            
            <label>Recipient Address:</label>
            <input type="text" id="swapRecipient" placeholder="0x...">
            
            <label>Amount (satoshis):</label>
            <input type="number" id="swapAmount" placeholder="1000000" value="1000000">
            
            <label>Timelock Duration (seconds):</label>
            <input type="number" id="swapTimelock" value="3600">
            
            <button onclick="app.initiateSwap()">üöÄ Initiate Atomic Swap</button>
            <div id="swapInitOutput" class="output" style="display:none;"></div>
            
            <h3>2. Lock Swap with Bitcoin:</h3>
            <label>Swap ID:</label>
            <input type="text" id="lockSwapId" placeholder="0x...">
            
            <label>Bitcoin Transaction ID:</label>
            <input type="text" id="lockBtcTxid" placeholder="BTC txid">
            
            <button onclick="app.lockSwap()">üîí Lock Swap</button>
            <div id="lockOutput" class="output" style="display:none;"></div>
            
            <h3>3. Complete Swap:</h3>
            <label>Swap ID:</label>
            <input type="text" id="completeSwapId" placeholder="0x...">
            
            <label>HTLC Secret:</label>
            <input type="text" id="completeSecret" placeholder="Secret from initiate step">
            
            <button onclick="app.completeSwap()">‚úÖ Complete Swap</button>
            <div id="completeOutput" class="output" style="display:none;"></div>
            
            <h3>4. Check Swap Status:</h3>
            <label>Swap ID:</label>
            <input type="text" id="statusSwapId" placeholder="0x...">
            
            <button onclick="app.checkSwapStatus()">üìä Check Status</button>
            <div id="statusOutput" class="output" style="display:none;"></div>
            
            <h3>Your Swaps:</h3>
            <div id="swapsList"></div>
        </div>

        <!-- BITCOIN BRIDGE -->
        <div class="section">
            <h2>‚Çø Bitcoin Bridge</h2>
            
            <h3>Generate SPV Proof:</h3>
            <label>Bitcoin Transaction ID:</label>
            <input type="text" id="spvTxid" placeholder="Bitcoin txid">
            
            <button onclick="app.generateSPV()">üîó Generate SPV Proof</button>
            <div id="spvOutput" class="output" style="display:none;"></div>
        </div>

        <!-- STARKNET CONTRACT -->
        <div class="section">
            <h2>üìú Starknet Contracts</h2>
            
            <h3>Commit Note to Contract:</h3>
            <label>Note Commitment:</label>
            <input type="text" id="contractCommitment" placeholder="0x...">
            
            <button onclick="app.commitToContract()">üì§ Commit to Starknet</button>
            <div id="contractOutput" class="output" style="display:none;"></div>
        </div>

        <!-- STATISTICS -->
        <div class="section">
            <h2>üìà Statistics</h2>
            <button onclick="app.loadStats()">üìä Load Statistics</button>
            <div id="statsOutput" class="output" style="display:none;"></div>
        </div>

        <!-- LOCAL STORAGE DATA -->
        <div class="section">
            <h2>üíæ Saved Data</h2>
            <button onclick="app.showSavedData()">üìÅ View Saved Notes & Swaps</button>
            <button onclick="app.clearSavedData()">üóëÔ∏è Clear All Data</button>
            <div id="savedDataOutput" class="output" style="display:none;"></div>
        </div>
    </div>

    <script>
        class StarCladApp {
            constructor() {
                this.backendUrl = '';
                this.apiKey = '';
                this.wallet = null;
                this.account = null;
                this.address = null;
                this.swapContractAddress = '';
                this.bridgeContractAddress = '';
                this.notes = [];
                this.swaps = [];
                
                this.loadFromStorage();
                this.log('Application initialized', 'info');
            }

            // LOGGING
            log(message, type = 'info') {
                const console = document.getElementById('console');
                const timestamp = new Date().toLocaleTimeString();
                const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
                const entry = document.createElement('div');
                entry.className = `console-entry ${className}`;
                entry.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
                console.appendChild(entry);
                console.scrollTop = console.scrollHeight;
                
                // Also log to browser console
                console[type === 'error' ? 'error' : 'log'](`[StarClad] ${message}`);
            }

            clearConsole() {
                document.getElementById('console').innerHTML = '';
                this.log('Console cleared', 'info');
            }

            // CONFIGURATION
            saveConfig() {
                this.backendUrl = document.getElementById('backendUrl').value;
                this.apiKey = document.getElementById('apiKey').value;
                this.swapContractAddress = document.getElementById('swapContract').value;
                this.bridgeContractAddress = document.getElementById('bridgeContract').value;
                
                localStorage.setItem('backendUrl', this.backendUrl);
                localStorage.setItem('apiKey', this.apiKey);
                localStorage.setItem('swapContract', this.swapContractAddress);
                localStorage.setItem('bridgeContract', this.bridgeContractAddress);
                
                this.log('Configuration saved to localStorage', 'success');
                alert('‚úÖ Configuration saved!');
            }

            loadFromStorage() {
                const backendUrl = localStorage.getItem('backendUrl');
                const apiKey = localStorage.getItem('apiKey');
                const swapContract = localStorage.getItem('swapContract');
                const bridgeContract = localStorage.getItem('bridgeContract');
                const notes = localStorage.getItem('notes');
                const swaps = localStorage.getItem('swaps');
                
                if (backendUrl) {
                    this.backendUrl = backendUrl;
                    document.getElementById('backendUrl').value = backendUrl;
                }
                if (apiKey) {
                    this.apiKey = apiKey;
                    document.getElementById('apiKey').value = apiKey;
                }
                if (swapContract) {
                    this.swapContractAddress = swapContract;
                    document.getElementById('swapContract').value = swapContract;
                }
                if (bridgeContract) {
                    this.bridgeContractAddress = bridgeContract;
                    document.getElementById('bridgeContract').value = bridgeContract;
                }
                if (notes) {
                    this.notes = JSON.parse(notes);
                    this.displayNotes();
                }
                if (swaps) {
                    this.swaps = JSON.parse(swaps);
                    this.displaySwaps();
                }
                
                this.log('Loaded configuration from localStorage', 'info');
            }

            // API CALLS
            async apiCall(endpoint, method = 'GET', data = null) {
                if (!this.backendUrl) {
                    this.log('Backend URL not configured', 'error');
                    throw new Error('Please configure backend URL first');
                }

                const url = this.backendUrl + endpoint;
                this.log(`API ${method} ${endpoint}`, 'info');
                
                const headers = { 'Content-Type': 'application/json' };
                if (this.apiKey) {
                    headers['X-API-Key'] = this.apiKey;
                }

                const options = { method, headers, mode: 'cors' };
                if (data && method !== 'GET') {
                    options.body = JSON.stringify(data);
                    this.log(`Request body: ${JSON.stringify(data)}`, 'info');
                }

                try {
                    const response = await fetch(url, options);
                    const result = await response.json();
                    
                    if (!response.ok) {
                        this.log(`API Error: ${result.error || 'Request failed'}`, 'error');
                        throw new Error(result.error || 'Request failed');
                    }
                    
                    this.log(`API Response received: ${JSON.stringify(result).substring(0, 100)}...`, 'success');
                    return result;
                } catch (error) {
                    this.log(`API call failed: ${error.message}`, 'error');
                    throw error;
                }
            }

            async testBackend() {
                this.log('Testing backend connection...', 'info');
                try {
                    const result = await this.apiCall('/health');
                    document.getElementById('backendStatus').textContent = 'Connected ‚úÖ';
                    document.getElementById('status').className = 'status connected';
                    this.log('Backend connection successful!', 'success');
                    alert('‚úÖ Backend is online and responding!');
                } catch (error) {
                    document.getElementById('backendStatus').textContent = 'Disconnected ‚ùå';
                    this.log('Backend connection failed', 'error');
                    alert('‚ùå Cannot connect to backend. Make sure it\'s running on ' + this.backendUrl);
                }
            }

            // WALLET CONNECTION
            async connectWallet() {
                this.log('Attempting to connect Starknet wallet...', 'info');
                try {
                    const starknet = window.starknet;
                    if (!starknet) {
                        this.log('No Starknet wallet found', 'error');
                        alert('‚ùå Please install ArgentX or Braavos wallet extension');
                        return;
                    }

                    await starknet.enable();
                    this.wallet = starknet;
                    this.account = starknet.account;
                    this.address = starknet.selectedAddress;

                    document.getElementById('walletStatus').textContent = `${this.address.substring(0, 6)}...${this.address.substring(this.address.length - 4)} ‚úÖ`;
                    
                    // Auto-fill addresses
                    document.getElementById('swapInitiator').value = this.address;
                    document.getElementById('noteRecipient').value = this.address;
                    document.getElementById('proofSpender').value = this.address;
                    
                    this.log(`Wallet connected: ${this.address}`, 'success');
                    alert('‚úÖ Wallet connected successfully!');
                } catch (error) {
                    this.log(`Wallet connection failed: ${error.message}`, 'error');
                    alert('‚ùå Failed to connect wallet: ' + error.message);
                }
            }

            // PRIVACY NOTES
            async generateNote() {
                const amount = document.getElementById('noteAmount').value;
                const recipient = document.getElementById('noteRecipient').value || this.address;
                const secret = document.getElementById('noteSecret').value;

                if (!amount) {
                    alert('‚ùå Please enter an amount');
                    return;
                }
                if (!recipient) {
                    alert('‚ùå Please enter a recipient address or connect wallet');
                    return;
                }

                this.log(`Generating privacy note: ${amount} sats for ${recipient}`, 'info');
                
                try {
                    const data = { amount, recipient };
                    if (secret) data.secret = secret;
                    
                    const result = await this.apiCall('/api/notes/generate', 'POST', data);
                    
                    // Save note
                    this.notes.push({
                        ...result,
                        timestamp: Date.now(),
                        amount: amount
                    });
                    localStorage.setItem('notes', JSON.stringify(this.notes));
                    
                    // Display result
                    document.getElementById('noteOutput').style.display = 'block';
                    document.getElementById('noteOutput').textContent = JSON.stringify(result, null, 2);
                    
                    // Auto-fill for next steps
                    document.getElementById('proofCommitment').value = result.commitment;
                    document.getElementById('contractCommitment').value = result.commitment;
                    
                    this.displayNotes();
                    this.log('Privacy note generated successfully!', 'success');
                    alert('‚úÖ Note generated! Check output below and save the commitment hash.');
                } catch (error) {
                    this.log(`Failed to generate note: ${error.message}`, 'error');
                    alert('‚ùå Failed to generate note: ' + error.message);
                }
            }

            async generateSpendProof() {
                const commitment = document.getElementById('proofCommitment').value;
                const spender = document.getElementById('proofSpender').value || this.address;

                if (!commitment || !spender) {
                    alert('‚ùå Please fill all fields');
                    return;
                }

                this.log(`Generating spend proof for commitment: ${commitment}`, 'info');
                
                try {
                    const result = await this.apiCall('/api/proofs/spend', 'POST', {
                        commitment,
                        spender
                    });
                    
                    document.getElementById('proofOutput').style.display = 'block';
                    document.getElementById('proofOutput').textContent = JSON.stringify(result, null, 2);
                    
                    this.log('Spend proof generated!', 'success');
                    alert('‚úÖ Spend proof generated!');
                } catch (error) {
                    this.log(`Failed to generate proof: ${error.message}`, 'error');
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            async getMerkleRoot() {
                this.log('Fetching Merkle root...', 'info');
                try {
                    const result = await this.apiCall('/api/merkle/root');
                    document.getElementById('merkleOutput').style.display = 'block';
                    document.getElementById('merkleOutput').textContent = JSON.stringify(result, null, 2);
                    this.log('Merkle root retrieved', 'success');
                } catch (error) {
                    this.log(`Failed to get Merkle root: ${error.message}`, 'error');
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            displayNotes() {
                const list = document.getElementById('notesList');
                if (this.notes.length === 0) {
                    list.innerHTML = '<p>No notes yet. Generate one above!</p>';
                    return;
                }
                
                list.innerHTML = this.notes.map((note, i) => `
                    <div class="data-item">
                        <strong>Note #${i + 1}</strong> (${new Date(note.timestamp).toLocaleString()})<br>
                        Amount: ${note.amount} sats<br>
                        Commitment: ${note.commitment}<br>
                        Nullifier: ${note.nullifier}<br>
                        <button onclick="app.copyToClipboard('${note.commitment}')">üìã Copy Commitment</button>
                    </div>
                `).join('');
            }

            // ATOMIC SWAPS
            async initiateSwap() {
                const initiator = document.getElementById('swapInitiator').value || this.address;
                const recipient = document.getElementById('swapRecipient').value;
                const amount = document.getElementById('swapAmount').value;
                const timelockDuration = document.getElementById('swapTimelock').value;

                if (!initiator || !recipient || !amount) {
                    alert('‚ùå Please fill all fields');
                    return;
                }

                this.log(`Initiating swap: ${amount} sats from ${initiator} to ${recipient}`, 'info');
                
                try {
                    const result = await this.apiCall('/api/swaps/initiate', 'POST', {
                        initiator,
                        recipient,
                        amount,
                        timelockDuration: parseInt(timelockDuration)
                    });
                    
                    // Save swap
                    this.swaps.push({
                        ...result,
                        timestamp: Date.now(),
                        amount: amount
                    });
                    localStorage.setItem('swaps', JSON.stringify(this.swaps));
                    
                    document.getElementById('swapInitOutput').style.display = 'block';
                    document.getElementById('swapInitOutput').textContent = JSON.stringify(result, null, 2);
                    
                    // Auto-fill next steps
                    if (result.swapId) {
                        document.getElementById('lockSwapId').value = result.swapId;
                        document.getElementById('completeSwapId').value = result.swapId;
                        document.getElementById('statusSwapId').value = result.swapId;
                    }
                    if (result.htlcSecret) {
                        document.getElementById('completeSecret').value = result.htlcSecret;
                    }
                    
                    this.displaySwaps();
                    this.log('Swap initiated! SAVE THE SECRET!', 'success');
                    alert('‚úÖ Swap initiated!\n\n‚ö†Ô∏è IMPORTANT: Save the HTLC secret shown in the output! You need it to complete the swap.');
                } catch (error) {
                    this.log(`Failed to initiate swap: ${error.message}`, 'error');
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            async lockSwap() {
                const swapId = document.getElementById('lockSwapId').value;
                const btcTxid = document.getElementById('lockBtcTxid').value;

                if (!swapId || !btcTxid) {
                    alert('‚ùå Please fill all fields');
                    return;
                }

                this.log(`Locking swap ${swapId} with BTC tx ${btcTxid}`, 'info');
                
                try {
                    const result = await this.apiCall('/api/swaps/lock', 'POST', {
                        swapId,
                        btcTxid
                    });
                    
                    document.getElementById('lockOutput').style.display = 'block';
                    document.getElementById('lockOutput').textContent = JSON.stringify(result, null, 2);
                    
                    this.log('Swap locked with Bitcoin!', 'success');
                    alert('‚úÖ Swap locked with Bitcoin transaction!');
                } catch (error) {
                    this.log(`Failed to lock swap: ${error.message}`, 'error');
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            async completeSwap() {
                const swapId = document.getElementById('completeSwapId').value;
                const secret = document.getElementById('completeSecret').value;

                if (!swapId || !secret) {
                    alert('‚ùå Please fill all fields');
                    return;
                }

                this.log(`Completing swap ${swapId} with secret`, 'info');
                
                try {
                    const result = await this.apiCall('/api/swaps/complete', 'POST', {
                        swapId,
                        secret
                    });
                    
                    document.getElementById('completeOutput').style.display = 'block';
                    document.getElementById('completeOutput').textContent = JSON.stringify(result, null, 2);
                    
                    this.log('Swap completed successfully!', 'success');
                    alert('‚úÖ Swap completed!');
                } catch (error) {
                    this.log(`Failed to complete swap: ${error.message}`, 'error');
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            async checkSwapStatus() {
                const swapId = document.getElementById('statusSwapId').value;

                if (!swapId) {
                    alert('‚ùå Please enter swap ID');
                    return;
                }

                this.log(`Checking status for swap ${swapId}`, 'info');
                
                try {
                    const result = await this.apiCall(`/api/swaps/${swapId}`);
                    document.getElementById('statusOutput').style.display = 'block';
                    document.getElementById('statusOutput').textContent = JSON.stringify(result, null, 2);
                    this.log('Swap status retrieved', 'success');
                } catch (error) {
                    this.log(`Failed to check status: ${error.message}`, 'error');
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            displaySwaps() {
                const list = document.getElementById('swapsList');
                if (this.swaps.length === 0) {
                    list.innerHTML = '<p>No swaps yet. Initiate one above!</p>';
                    return;
                }
                
                list.innerHTML = this.swaps.map((swap, i) => `
                    <div class="data-item">
                        <strong>Swap #${i + 1}</strong> (${new Date(swap.timestamp).toLocaleString()})<br>
                        Amount: ${swap.amount} sats<br>
                        Swap ID: ${swap.swapId}<br>
                        Secret: ${swap.htlcSecret || 'N/A'}<br>
                        <button onclick="app.copyToClipboard('${swap.swapId}')">üìã Copy ID</button>
                    </div>
                `).join('');
            }

            // BITCOIN BRIDGE
            async generateSPV() {
                const txid = document.getElementById('spvTxid').value;

                if (!txid) {
                    alert('‚ùå Please enter Bitcoin transaction ID');
                    return;
                }

                this.log(`Generating SPV proof for tx ${txid}`, 'info');
                
                try {
                    const result = await this.apiCall('/api/btc/spv-proof', 'POST', { txid });
                    document.getElementById('spvOutput').style.display = 'block';
                    document.getElementById('spvOutput').textContent = JSON.stringify(result, null, 2);
                    this.log('SPV proof generated!', 'success');
                    alert('‚úÖ SPV proof generated!');
                } catch (error) {
                    this.log(`Failed to generate SPV proof: ${error.message}`, 'error');
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            // STARKNET CONTRACT
            async commitToContract() {
                if (!this.account) {
                    alert('‚ùå Please connect Starknet wallet first');
                    return;
                }

                const commitment = document.getElementById('contractCommitment').value;

                if (!commitment) {
                    alert('‚ùå Please enter commitment hash');
                    return;
                }

                if (!this.swapContractAddress) {
                    alert('‚ùå Please configure swap contract address');
                    return;
                }

                this.log(`Committing note to Starknet contract ${this.swapContractAddress}`, 'info');
                
                try {
                    document.getElementById('contractOutput').style.display = 'block';
                    document.getElementById('contractOutput').textContent = 'Submitting transaction to Starknet...';
                    
                    const tx = await this.account.execute({
                        contractAddress: this.swapContractAddress,
                        entrypoint: 'commit_note',
                        calldata: [commitment]
                    });
                    
                    this.log(`Transaction submitted: ${tx.transaction_hash}`, 'success');
                    document.getElementById('contractOutput').textContent = `Transaction Hash: ${tx.transaction_hash}\n\nWaiting for confirmation...`;
                    
                    await this.wallet.provider.waitForTransaction(tx.transaction_hash);
                    
                    document.getElementById('contractOutput').textContent += `\n\n‚úÖ Transaction confirmed!`;
                    this.log('Note committed to Starknet!', 'success');
                    alert('‚úÖ Note committed to Starknet contract!');
                } catch (error) {
                    this.log(`Contract call failed: ${error.message}`, 'error');
                    document.getElementById('contractOutput').textContent = `Error: ${error.message}`;
                    alert('‚ùå Failed: ' + error.message);
                }
            }

            // STATISTICS
            async loadStats() {
                this.log('Loading statistics...', 'info');
                try {
                    const result = await this.apiCall('/api/swaps/stats');
                    document.getElementById('statsOutput').style.display = 'block';
                    document.getElementById('statsOutput').textContent = JSON.stringify(result, null, 2);
                    this.log('Statistics loaded', 'success');
                } catch (error) {
                    this.log(`Failed to load stats: ${error.message}`, 'error');
                    document.getElementById('statsOutput').style.display = 'block';
                    document.getElementById('statsOutput').textContent = `Error: ${error.message}\n\nMake sure backend is running on ${this.backendUrl}`;
                }
            }

            // STORAGE
            showSavedData() {
                const output = document.getElementById('savedDataOutput');
                output.style.display = 'block';
                output.textContent = `SAVED NOTES (${this.notes.length}):\n${JSON.stringify(this.notes, null, 2)}\n\nSAVED SWAPS (${this.swaps.length}):\n${JSON.stringify(this.swaps, null, 2)}`;
                this.log('Displayed saved data', 'info');
            }

            clearSavedData() {
                if (!confirm('‚ö†Ô∏è This will delete all saved notes and swaps. Are you sure?')) {
                    return;
                }
                
                this.notes = [];
                this.swaps = [];
                localStorage.removeItem('notes');
                localStorage.removeItem('swaps');
                this.displayNotes();
                this.displaySwaps();
                this.log('All saved data cleared', 'info');
                alert('‚úÖ All data cleared');
            }

            // UTILITIES
            copyToClipboard(text) {
                navigator.clipboard.writeText(text);
                this.log(`Copied to clipboard: ${text.substring(0, 20)}...`, 'info');
                alert('‚úÖ Copied to clipboard!');
            }
        }

        // Initialize app
        const app = new StarCladApp();
        
        // Auto-load notes and swaps on page load
        window.addEventListener('load', () => {
            app.displayNotes();
            app.displaySwaps();
            app.log('Page loaded - ready for use', 'success');
        });
    </script>
</body>
</html>
